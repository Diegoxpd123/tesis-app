<div class="estudiante-detail-container page-container starry-background" [class.dark-theme]="isDarkMode">
  <!-- Bot칩n de Atr치s -->
  <div class="back-button-container">
    <button class="back-button" (click)="goBack()" [class.dark-theme]="isDarkMode">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      <span>Volver</span>
    </button>
  </div>

  <!-- Header del estudiante -->
  <div class="student-header">
    <div class="student-info">
      <img src="/assets/img/robot.png" alt="Avatar" class="student-avatar" />
      <div class="student-details">
        <h1 class="student-name">{{ usuarioNombre }}</h1>
        <p class="student-user">{{ usuarioEmail || 'Usuario ' + usuarioid }}</p>
        <p class="student-description" *ngIf="usuarioGrado && usuarioSeccion">
          {{ usuarioGrado }} - {{ usuarioSeccion }}
        </p>
        <p class="student-description" *ngIf="!usuarioGrado || !usuarioSeccion">
          El estudiante ha completado su reforzamiento
        </p>
      </div>
    </div>
    <div class="radar-container">
      <canvas id="radarChart" width="150" height="150"></canvas>
    </div>
  </div>

  <br>

  <!-- Loading de datos -->
  <div class="loading-data-container" *ngIf="isLoadingData">
    <div class="loading-data-content">
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
      <div class="loading-text">
        <h3>{{ loadingMessage }}</h3>
        <p *ngIf="totalQuestions > 0">
          Cargando preguntas: {{ loadedQuestions }} / {{ totalQuestions }}
        </p>
        <div class="progress-bar" *ngIf="totalQuestions > 0">
          <div class="progress-fill" [style.width.%]="(loadedQuestions / totalQuestions) * 100"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estad칤sticas del estudiante -->
  <div class="student-stats">
    <div class="stats-card">
      <div class="stats-content">
        <span class="stats-label">Cursos dominados:</span>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%"></div>
        </div>
        <span class="stats-value">3/3</span>
      </div>
    </div>
  </div>

  <br>

  <!-- Filtros de fechas -->
  <div class="filters-container">
    <div class="filters-header">
      <h3>Filtros de Fecha</h3>
    </div>
    <div class="filters-content">
      <div class="filter-group">
        <label>Fecha Inicio:</label>
        <input type="date" [(ngModel)]="fechainicio" class="filter-input" />
      </div>
      <div class="filter-group">
        <label>Fecha Fin:</label>
        <input type="date" [(ngModel)]="fechafin" class="filter-input" />
      </div>
    </div>
  </div>

  <br>

  <!-- Cursos -->
  <div class="courses-container">
    <h2 class="courses-title">Puntaje Semanal</h2>

    <!-- 游닂 Matem치ticas -->
    <div class="course-card" style="--color:#f9a825;">
      <div class="course-header">
        <span class="course-name">游닂 Matem치ticas</span>
        <span class="course-score">{{ calcularPuntaje(1) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 80%"></div>
        </div>
      </div>
      <button class="course-btn" (click)="mostrarResultados(1)">Ver Detalles</button>
    </div>

    <!-- 游닁 Comunicaci칩n -->
    <div class="course-card" style="--color:#4fc3f7;">
      <div class="course-header">
        <span class="course-name">游닁 Comunicaci칩n</span>
        <span class="course-score">{{ calcularPuntaje(2) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%"></div>
        </div>
      </div>
      <button class="course-btn" (click)="mostrarResultados(2)">Ver Detalles</button>
    </div>

    <!-- 游닃 Ciencias y Tecnolog칤a -->
    <div class="course-card" style="--color:#8bc34a;">
      <div class="course-header">
        <span class="course-name">游닃 Ciencias y Tecnolog칤a</span>
        <span class="course-score">{{ calcularPuntaje(3) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 53%"></div>
        </div>
      </div>
      <button class="course-btn" (click)="mostrarResultados(3)">Ver Detalles</button>
    </div>
  </div>
</div>

<!-- Modal para mostrar reportes o mensaje de no datos -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" [class.dark-theme]="isDarkMode" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modalTitle }}</h3>
      <button class="modal-close" (click)="closeModal()">칑</button>
    </div>

    <div class="modal-body">
      <!-- Loading -->
      <div *ngIf="loading" class="loading-modal">
        <div class="loading-spinner"></div>
        <p>Buscando datos del estudiante...</p>
      </div>

      <!-- Mensaje de no datos -->
      <div *ngIf="!loading && modalMessage" class="no-data-modal">
        <div class="no-data-icon">游늵</div>
        <p>{{ modalMessage }}</p>
      </div>

      <!-- Reporte con datos -->
      <div *ngIf="!loading && !modalMessage && hasData[modalCourseId]">
        <div class="modal-actions">
          <button class="btn-excel" (click)="exportarExcel(modalCourseId)">游닌 Descargar Excel</button>
        </div>

        <div class="table-container">
          <table class="results-table">
            <thead>
              <tr>
                <th>Tema</th>
                <th>Evaluaci칩n</th>
                <th>Respuestas</th>
                <th>Tiempo (seg)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of resultados[modalCourseId]">
                <td>{{ r.tema }}</td>
                <td>{{ r.evaluacion }}</td>
                <td>{{ r.respuestas_buenas_sobre_totales }}</td>
                <td>{{ r.total_tiempo }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
