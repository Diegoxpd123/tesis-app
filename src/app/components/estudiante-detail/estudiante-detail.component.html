<div class="estudiante-detail-container page-container starry-background" [class.dark-theme]="isDarkMode">
  <!-- Bot√≥n de Atr√°s -->
  <div class="back-button-container">
    <button class="back-button" (click)="goBack()" [class.dark-theme]="isDarkMode">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      <span>Volver</span>
    </button>
  </div>

  <!-- Header del estudiante -->
  <div class="student-header">
    <div class="student-info">
      <img src="/assets/img/robot.png" alt="Avatar" class="student-avatar" />
      <div class="student-details">
        <h1 class="student-name">{{ usuarioNombre }}</h1>
        <p class="student-user">{{ usuarioEmail || 'Usuario ' + usuarioid }}</p>
        <p class="student-description" *ngIf="usuarioGrado && usuarioSeccion">
          {{ usuarioGrado }} - {{ usuarioSeccion }}
        </p>
        <p class="student-description" *ngIf="!usuarioGrado || !usuarioSeccion">
          El estudiante ha completado su reforzamiento
        </p>
      </div>
    </div>
    <div class="radar-container">
      <canvas id="radarChart" width="400" height="400"></canvas>
    </div>
  </div>

  <br>

  <!-- Selector de fechas -->
  <div class="date-selector-container">
    <div class="date-selector">
      <label for="fechainicio">Fecha Inicio:</label>
      <input
        type="date"
        id="fechainicio"
        [(ngModel)]="fechainicio"
        class="date-input"
      />
    </div>
    <div class="date-selector">
      <label for="fechafin">Fecha Fin:</label>
      <input
        type="date"
        id="fechafin"
        [(ngModel)]="fechafin"
        class="date-input"
      />
    </div>
    <div class="search-button-container">
      <button
        class="search-button"
        (click)="buscarReportes()"
        [disabled]="isLoadingData"
        [class.dark-theme]="isDarkMode"
      >
        <span *ngIf="!isLoadingData">üîç Buscar</span>
        <span *ngIf="isLoadingData">‚è≥ Buscando...</span>
      </button>
    </div>
  </div>

  <!-- Loading de datos -->
  <div class="loading-data-container" *ngIf="isLoadingData">
    <div class="loading-data-content">
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
      <div class="loading-text">
        <h3>{{ loadingMessage }}</h3>
        <p *ngIf="totalQuestions > 0">
          Cargando preguntas: {{ loadedQuestions }} / {{ totalQuestions }}
        </p>
        <div class="progress-bar" *ngIf="totalQuestions > 0">
          <div class="progress-fill" [style.width.%]="(loadedQuestions / totalQuestions) * 100"></div>
        </div>
      </div>
    </div>
  </div>



  <!-- Cursos -->
  <div class="courses-container">
    <h2 class="courses-title">Puntaje Semanal</h2>

    <!-- üìò Matem√°ticas -->
    <div class="course-card" style="--color:#f9a825;">
      <div class="course-header">
        <span class="course-name">üìò Matem√°ticas</span>
        <span class="course-score">{{ calcularPuntaje(1) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 80%"></div>
        </div>
      </div>

        <!-- Reporte de Matem√°ticas -->
        <div class="course-report" *ngIf="hasDetailedData[1]">
          <div class="report-header">
            <h4>Reporte de Matem√°ticas - {{ tipoReporte === 'examen' ? 'Ex√°menes' : 'Pr√°cticas' }}</h4>
            <div class="report-controls">
              <select [(ngModel)]="tipoReporte" (change)="onTipoReporteChange()" class="report-type-select">
                <option value="examen">Ex√°menes</option>
                <option value="practica">Pr√°cticas</option>
              </select>
              <button class="btn-excel" (click)="exportarExcel(1)">üì• Descargar Excel</button>
            </div>
          </div>

          <!-- Reporte detallado -->
          <div class="detailed-report">
            <div class="table-container">
              <table class="detailed-table">
                <thead>
                  <tr>
                    <th>Evaluaci√≥n</th>
                    <th>Pregunta</th>
                    <th>Respuesta Correcta</th>
                    <th>Estado</th>
                    <th>Tiempo Respuesta</th>
                    <th>Tiempo Reforzamiento</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let r of reporteDetallado[1]">
                    <td>{{ r.evaluacion }}</td>
                    <td class="question-cell">{{ r.pregunta }}</td>
                    <td>{{ r.respuesta_correcta }}</td>
                    <td>
                      <span class="status-badge" [class.correct]="r.estado_respuesta === 'Correcta'"
                            [class.incorrect]="r.estado_respuesta === 'Incorrecta'">
                        {{ r.estado_respuesta }}
                      </span>
                    </td>
                    <td>{{ r.tiempo_respuesta }}s</td>
                    <td>{{ r.tiemporeforzamiento }}s</td>
                    <td>{{ r.fecha_respuesta | date:'short' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Mensaje de no datos para Matem√°ticas -->
        <div class="no-data-report" *ngIf="!hasDetailedData[1] && !loading">
          <div class="no-data-icon">üìä</div>
          <p>No hay datos disponibles para Matem√°ticas en el rango de fechas seleccionado</p>
        </div>
    </div>

    <!-- üìó Comunicaci√≥n -->
    <div class="course-card" style="--color:#4fc3f7;">
      <div class="course-header">
        <span class="course-name">üìó Comunicaci√≥n</span>
        <span class="course-score">{{ calcularPuntaje(2) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%"></div>
        </div>
      </div>

        <!-- Reporte de Comunicaci√≥n -->
        <div class="course-report" *ngIf="hasDetailedData[2]">
          <div class="report-header">
            <h4>Reporte de Comunicaci√≥n - {{ tipoReporte === 'examen' ? 'Ex√°menes' : 'Pr√°cticas' }}</h4>
            <div class="report-controls">
              <select [(ngModel)]="tipoReporte" (change)="onTipoReporteChange()" class="report-type-select">
                <option value="examen">Ex√°menes</option>
                <option value="practica">Pr√°cticas</option>
              </select>
              <button class="btn-excel" (click)="exportarExcel(2)">üì• Descargar Excel</button>
            </div>
          </div>

          <!-- Reporte detallado -->
          <div class="detailed-report">
            <div class="table-container">
              <table class="detailed-table">
                <thead>
                  <tr>
                    <th>Evaluaci√≥n</th>
                    <th>Pregunta</th>
                    <th>Respuesta Correcta</th>
                    <th>Estado</th>
                    <th>Tiempo Respuesta</th>
                    <th>Tiempo Reforzamiento</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let r of reporteDetallado[2]">
                    <td>{{ r.evaluacion }}</td>
                    <td class="question-cell">{{ r.pregunta }}</td>
                    <td>{{ r.respuesta_correcta }}</td>
                    <td>
                      <span class="status-badge" [class.correct]="r.estado_respuesta === 'Correcta'"
                            [class.incorrect]="r.estado_respuesta === 'Incorrecta'">
                        {{ r.estado_respuesta }}
                      </span>
                    </td>
                    <td>{{ r.tiempo_respuesta }}s</td>
                    <td>{{ r.tiemporeforzamiento }}s</td>
                    <td>{{ r.fecha_respuesta | date:'short' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Mensaje de no datos para Comunicaci√≥n -->
        <div class="no-data-report" *ngIf="!hasDetailedData[2] && !loading">
          <div class="no-data-icon">üìä</div>
          <p>No hay datos disponibles para Comunicaci√≥n en el rango de fechas seleccionado</p>
        </div>
    </div>

    <!-- üìô Ciencias y Tecnolog√≠a -->
    <div class="course-card" style="--color:#8bc34a;">
      <div class="course-header">
        <span class="course-name">üìô Ciencias y Tecnolog√≠a</span>
        <span class="course-score">{{ calcularPuntaje(3) }}</span>
      </div>
      <div class="course-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 53%"></div>
        </div>
      </div>

        <!-- Reporte de Ciencias y Tecnolog√≠a -->
        <div class="course-report" *ngIf="hasDetailedData[3]">
          <div class="report-header">
            <h4>Reporte de Ciencias y Tecnolog√≠a - {{ tipoReporte === 'examen' ? 'Ex√°menes' : 'Pr√°cticas' }}</h4>
            <div class="report-controls">
              <select [(ngModel)]="tipoReporte" (change)="onTipoReporteChange()" class="report-type-select">
                <option value="examen">Ex√°menes</option>
                <option value="practica">Pr√°cticas</option>
              </select>
              <button class="btn-excel" (click)="exportarExcel(3)">üì• Descargar Excel</button>
            </div>
          </div>

          <!-- Reporte detallado -->
          <div class="detailed-report">
            <div class="table-container">
              <table class="detailed-table">
                <thead>
                  <tr>
                    <th>Evaluaci√≥n</th>
                    <th>Pregunta</th>
                    <th>Respuesta Correcta</th>
                    <th>Estado</th>
                    <th>Tiempo Respuesta</th>
                    <th>Tiempo Reforzamiento</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let r of reporteDetallado[3]">
                    <td>{{ r.evaluacion }}</td>
                    <td class="question-cell">{{ r.pregunta }}</td>
                    <td>{{ r.respuesta_correcta }}</td>
                    <td>
                      <span class="status-badge" [class.correct]="r.estado_respuesta === 'Correcta'"
                            [class.incorrect]="r.estado_respuesta === 'Incorrecta'">
                        {{ r.estado_respuesta }}
                      </span>
                    </td>
                    <td>{{ r.tiempo_respuesta }}s</td>
                    <td>{{ r.tiemporeforzamiento }}s</td>
                    <td>{{ r.fecha_respuesta | date:'short' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Mensaje de no datos para Ciencias y Tecnolog√≠a -->
        <div class="no-data-report" *ngIf="!hasDetailedData[3] && !loading">
          <div class="no-data-icon">üìä</div>
          <p>No hay datos disponibles para Ciencias y Tecnolog√≠a en el rango de fechas seleccionado</p>
        </div>
    </div>
  </div>
</div>

